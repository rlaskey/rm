worker_processes auto;

include modules.d/*.conf;

events {
	worker_connections  1024;
}


http {
	server {
		listen 80;
		server_name {{ domain }} www.{{ domain }};
		if ($host != {{ domain }}) {
			return 301 https://{{ domain }}$request_uri;
		}
		location / {
			proxy_pass http://127.0.0.1:{{ app_port }};
			proxy_buffering off;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
		}
	}

	# sudo certbot --nginx
	# ^^ this will mess this file up. That's OK.

	# Extra things to try, for the SSL server:
	# http2 on;
}
